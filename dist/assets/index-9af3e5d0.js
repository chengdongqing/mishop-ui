import{r as h,j as e,c as E,f as L,g as M,h as U,P as D,G as F,B as w,i as X,t as k,k as Y,a as $,b as G,A as S,F as C,e as A,R as B,p as I,I as O}from"./index-ad9c4655.js";import{R as P}from"./RightOutlined-6272dd96.js";const T="_radio_item_10wbe_1",V="_icon_10wbe_8",q="_label_10wbe_15",H="_active_10wbe_23",J="_disabled_10wbe_27",K="_radio_group_10wbe_37",b={radio_item:T,icon:V,label:q,active:H,disabled:J,radio_group:K},R=h.createContext(null);function N({children:n,value:a,disabled:s}){const t=h.useContext(R),o=s||(t==null?void 0:t.disabled);return e.jsxs("div",{className:E(b.radio_item,(t==null?void 0:t.value)===a&&b.active,o&&b.disabled),onClick:()=>{o||t==null||t.onChange(a)},children:[e.jsx("div",{className:b.icon}),e.jsx("div",{className:b.label,children:n})]})}N.Group=function(a){const[s,t]=L(a.value,a.defaultValue,a.onChange);return e.jsx(R.Provider,{value:{value:s,disabled:a.disabled,onChange:t},children:e.jsx("div",{className:b.radio_group,children:a.children})})};function Q(n){const[a,s]=h.useState();return h.useEffect(()=>{const t=URL.createObjectURL(n);return s(t),()=>{URL.revokeObjectURL(t)}},[n]),a}function W(n,a,s,t,o){h.useEffect(()=>{var j;if(!n||!s)return;const{width:i,height:l}=s,g=(s.width-t.width)/2,_=(s.height-t.height)/2;o({x:g,y:_});const x=(j=a.current)==null?void 0:j.getContext("2d"),c=new Image;return c.src=n,c.onload=()=>{const v=i,u=c.height/c.width*i,m=0,d=(v-u)/2;x.drawImage(c,m,d,v,u)},()=>{x.clearRect(0,0,i,l)}},[n,s])}function Z(n,a,s,t){h.useEffect(()=>{if(!n.current||!a)return;const{width:o,height:i}=a,l=n.current.getContext("2d");return l.fillStyle="rgba(0,0,0,0.6)",l.fillRect(0,0,o,i),l.clearRect(s.x,s.y,t.width,t.height),()=>{l.clearRect(0,0,o,i)}},[s,t])}function z(n,a,s){return t=>{var x;if(!n)return;let o=t.clientX,i=t.clientY;const l=(x=a.current)==null?void 0:x.getBoundingClientRect(),g=c=>{const j=c.clientX-o,v=c.clientY-i;s(u=>{let m=u.x+j,d=u.y+v;return(m<0||m>n.width-l.width)&&(m=u.x),(d<0||d>n.height-l.height)&&(d=u.y),{x:m,y:d}}),o=c.clientX,i=c.clientY},_=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",_)}}function ee(n,a,s,t,o){return(i,l)=>{if(i.stopPropagation(),!n)return;const g=i.clientX,_=i.clientY,x=j=>{const v=j.clientX-g,u=j.clientY-_,m={...s},d={...a};l.includes("e")&&(m.width+=v),l.includes("w")&&(m.width-=v,d.x+=v),l.includes("s")&&(m.height+=u),l.includes("n")&&(m.height-=u,d.y+=u),!(m.width<100||m.height<100||d.x<0||d.y<0||m.width+d.x>n.width||m.height+d.y>n.height)&&(t(m),o(d))},c=()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",x),document.addEventListener("mouseup",c)}}function se({filename:n,imageCanvasRef:a,cropBoxPosition:s,cropBoxSize:t}){return()=>new Promise(o=>{const i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(a.current,s.x,s.y,t.width,t.height,0,0,t.width,t.height),i.toBlob(g=>{if(g){const _=M(g,n);o([_,i.toDataURL("image/png")])}},"image/png")})}const te="_crop_content_1hnba_1",ne="_mask_1hnba_5",ae="_crop_box_1hnba_13",ie="_grid_1hnba_22",ce="_grid_h_1hnba_26",le="_grid_v_1hnba_36",oe="_borders_1hnba_46",re="_border_item_1hnba_53",de="_points_1hnba_86",me="_point_item_1hnba_93",he="_center_point_1hnba_147",p={crop_content:te,mask:ne,crop_box:ae,grid:ie,grid_h:ce,grid_v:le,borders:oe,border_item:re,points:de,point_item:me,center_point:he},_e=h.forwardRef(({file:n},a)=>{const s=h.useRef(null),t=h.useRef(null),o=h.useRef(null),i=h.useRef(null),[l,g]=h.useState({x:0,y:0}),[_,x]=h.useState({width:200,height:200}),[c]=U(s),j=Q(n);W(j,t,c,_,g),Z(o,c,l,_);const v=z(c,i,g),u=ee(c,l,_,x,g),m=se({filename:n.name,imageCanvasRef:t,cropBoxSize:_,cropBoxPosition:l});return h.useImperativeHandle(a,()=>({crop:m})),e.jsxs("div",{ref:s,className:p.crop_content,children:[e.jsx("canvas",{ref:t,width:c==null?void 0:c.width,height:c==null?void 0:c.height,style:{width:"100%",height:"100%"}}),e.jsx("canvas",{ref:o,width:c==null?void 0:c.width,height:c==null?void 0:c.height,className:p.mask}),e.jsxs("div",{ref:i,className:p.crop_box,style:{..._,transform:`translate3d(${l.x}px, ${l.y}px, 0)`},onMouseDown:v,children:[e.jsxs("div",{className:p.grid,children:[e.jsx("div",{className:p.grid_h}),e.jsx("div",{className:p.grid_v})]}),e.jsx("div",{className:p.borders,children:["e","s","w","n"].map(d=>e.jsx("span",{className:p.border_item,onMouseDown:y=>{u(y,d)}},d))}),e.jsx("div",{className:p.points,children:["ne","e","se","s","sw","w","nw","n"].map(d=>e.jsx("span",{className:p.point_item,onMouseDown:y=>{u(y,d)}},d))}),e.jsx("div",{className:p.center_point})]})]})}),ue="_container_i31g2_1",ge="_title_i31g2_4",pe="_upload_content_i31g2_10",xe="_btn_i31g2_13",ve="_file_input_i31g2_19",fe="_tips_i31g2_29",je="_actions_i31g2_34",be="_gray_i31g2_43",f={container:ue,title:ge,upload_content:pe,btn:xe,file_input:ve,tips:fe,actions:je,gray:be};function we({onChange:n}){const[a,s]=h.useState(),t=h.useRef(null);return e.jsxs("div",{className:f.container,children:[e.jsx("div",{className:f.title,children:"设置头像"}),a?e.jsxs("div",{children:[e.jsx(_e,{ref:t,file:a}),e.jsxs(F,{columns:2,gap:"2rem",className:f.actions,children:[e.jsx(w,{gray:!0,className:E(f.btn,f.gray),onClick:()=>{s(void 0)},children:"重新上传"}),e.jsx(w,{className:f.btn,onClick:()=>{var o;(o=t.current)==null||o.crop().then(([i,l])=>{console.log(i),n(l)})},children:"确定"})]})]}):e.jsxs("div",{className:f.upload_content,children:[e.jsxs("label",{children:[e.jsx("input",{type:"file",accept:"image/*",className:f.file_input,onChange:o=>{var l;const i=(l=o.target.files)==null?void 0:l[0];!i||!X(i.name,["jpg","png","jpeg"])?k.warning("图片格式不符合要求！"):i.size>1024*1024*10?k.warning("图片大小不能超过10MB！"):s(i)}}),e.jsx(w,{className:f.btn,children:"上传头像"})]}),e.jsx("div",{className:f.tips,children:"图片格式jpg、png、jpeg，大小不超过10MB"})]})]})}function Ne(n){const a=D.open({width:"45rem",footer:null,content:e.jsx(we,{onChange:s=>{n(s),a()}})})}const ye="_form_item_k2lp2_1",Ce="_label_k2lp2_10",ke="_value_k2lp2_14",Ee="_avatar_k2lp2_19",Re="_icon_arrow_k2lp2_25",Le="_btn_k2lp2_28",r={form_item:ye,label:Ce,value:ke,avatar:Ee,icon_arrow:Re,btn:Le};function De(){const[n,a]=Y(),s=$(),t=G(),[o,i]=h.useState();return e.jsxs(e.Fragment,{children:[e.jsx(S.Title,{title:"个人信息"}),e.jsxs(C,{noStyle:!0,initialValues:{...s},onOk:l=>{o&&(l.avatarUrl=o),t(A.actions.modifyUser(l)),a()},children:[e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label,children:"头像"}),e.jsx("div",{className:r.value,children:n?e.jsxs(B,{align:"middle",justify:"space-between",style:{cursor:"pointer"},onClick:()=>{Ne(i)},children:[e.jsx("img",{alt:"",src:o||(s==null?void 0:s.avatarUrl),className:r.avatar}),e.jsx(P,{className:r.icon_arrow})]}):e.jsx("img",{alt:"",src:s==null?void 0:s.avatarUrl,className:r.avatar})})]}),e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label,children:"昵称"}),e.jsx("div",{className:r.value,children:n?e.jsx(C.Item,{name:"name",rules:[{required:!0,message:"昵称不能为空"},{pattern:I.username,message:"昵称为2-20个汉字、英文或数字"}],children:e.jsx(O,{})}):e.jsx("span",{children:s==null?void 0:s.name})})]}),e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label,children:"性别"}),e.jsx("div",{className:r.value,children:n?e.jsx(C.Item,{name:"gender",children:e.jsxs(N.Group,{children:[e.jsx(N,{value:1,children:"男"}),e.jsx(N,{value:2,children:"女"})]})}):e.jsx("span",{children:s!=null&&s.gender?{1:"男",2:"女"}[s==null?void 0:s.gender]:"未知"})})]}),e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label,children:"小米ID"}),e.jsx("div",{className:r.value,children:s==null?void 0:s.id})]}),e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label,children:"国家/地区"}),e.jsx("div",{className:r.value,children:"中国"})]}),e.jsxs("div",{className:r.form_item,children:[e.jsx("div",{className:r.label}),e.jsx("div",{className:r.value,style:{paddingLeft:0},children:n?e.jsx(w,{className:r.btn,type:"submit",children:"保存"},"save"):e.jsx(w,{className:r.btn,onClick:a,children:"编辑"},"edit")})]})]})]})}export{De as default};
